from django.shortcuts import render, redirect
from django.contrib.auth import login, logout, authenticate
from django.contrib.auth.forms import AuthenticationForm
from django.contrib import messages
from .forms import UserRegistrationForm
from src_new.databaseModules import UsersDB_module

def index(request):
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"""
    return render(request, 'index.html')


def nko_list(request):
    """–°–ø–∏—Å–æ–∫ –ù–ö–û"""
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    nko_list = [
        {
            'id': 1,
            'icon': 'üå±',
            'category': '–≠–∫–æ–ª–æ–≥–∏—è',
            'name': '–ó–µ–ª—ë–Ω—ã–π –≥–æ—Ä–æ–¥',
            'description': '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ–∑–µ–ª–µ–Ω–µ–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞, –ø—Ä–æ–≤–æ–¥–∏—Ç —Å—É–±–±–æ—Ç–Ω–∏–∫–∏ –∏ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–∏–∏. –í–æ–ª–æ–Ω—Ç—ë—Ä—ã –ø–æ–º–æ–≥–∞—é—Ç –≤ –ø–æ—Å–∞–¥–∫–µ –¥–µ—Ä–µ–≤—å–µ–≤ –∏ —É–±–æ—Ä–∫–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π.',
            'address': '–≥. –°–∞—Ä–æ–≤, —É–ª. –õ–µ–Ω–∏–Ω–∞, 25',
            'website': '#',
            'vk': '#'
        },
        {
            'id': 2,
            'icon': '‚ù§Ô∏è',
            'category': '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å',
            'name': '–î–æ–±—Ä—ã–µ —Å–µ—Ä–¥—Ü–∞',
            'description': '–ü–æ–º–æ—â—å –ø–æ–∂–∏–ª—ã–º –ª—é–¥—è–º –∏ –ª—é–¥—è–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏. –í–æ–ª–æ–Ω—Ç—ë—Ä—ã –æ–∫–∞–∑—ã–≤–∞—é—Ç –±—ã—Ç–æ–≤—É—é –ø–æ–º–æ—â—å, –æ—Ä–≥–∞–Ω–∏–∑—É—é—Ç –¥–æ—Å—É–≥ –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è.',
            'address': '–≥. –û–±–Ω–∏–Ω—Å–∫, –ø—Ä. –õ–µ–Ω–∏–Ω–∞, 103',
            'website': '#',
            'vk': '#'
        },
        {
            'id': 3,
            'icon': 'üé®',
            'category': '–ö—É–ª—å—Ç—É—Ä–∞',
            'name': '–ö—É–ª—å—Ç—É—Ä–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ',
            'description': '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è —Ä–µ–≥–∏–æ–Ω–∞. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤—ã—Å—Ç–∞–≤–æ–∫, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–æ–≤ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.',
            'address': '–≥. –°–µ–≤–µ—Ä—Å–∫, —É–ª. –ö–∞–ª–∏–Ω–∏–Ω–∞, 15',
            'website': '#',
            'vk': '#'
        }
    ]
    return render(request, 'nko.html', {'nko_list': nko_list})


def nko_detail(request, nko_id):
    """–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ù–ö–û"""
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    nko = {
        'id': nko_id,
        'icon': 'üå±',
        'category': '–≠–∫–æ–ª–æ–≥–∏—è',
        'name': '–ó–µ–ª—ë–Ω—ã–π –≥–æ—Ä–æ–¥',
        'about': '–ù–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è "–ó–µ–ª—ë–Ω—ã–π –≥–æ—Ä–æ–¥" –±—ã–ª–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –≤ 2018 –≥–æ–¥—É –≥—Ä—É–ø–ø–æ–π –∞–∫—Ç–∏–≤–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π –°–∞—Ä–æ–≤–∞, –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω–Ω—ã—Ö —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π –≤ –≥–æ—Ä–æ–¥–µ.',
        'activities': '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ–∑–µ–ª–µ–Ω–µ–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞, –ø—Ä–æ–≤–æ–¥–∏—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å—É–±–±–æ—Ç–Ω–∏–∫–∏ –∏ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞–∫—Ü–∏–∏.',
        'volunteer_help': '–í–æ–ª–æ–Ω—Ç—ë—Ä—ã –ø–æ–º–æ–≥–∞—é—Ç –≤ –ø–æ—Å–∞–¥–∫–µ –¥–µ—Ä–µ–≤—å–µ–≤ –∏ –∫—É—Å—Ç–∞—Ä–Ω–∏–∫–æ–≤, —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —É–±–æ—Ä–∫–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π.',
        'address': '–≥. –°–∞—Ä–æ–≤, —É–ª. –õ–µ–Ω–∏–Ω–∞, 25',
        'email': 'info@green-city.ru',
        'phone': '+7 (900) 123-45-67',
        'website': 'https://green-city.ru',
        'vk': 'https://vk.com/greencity'
    }
    return render(request, 'nko_detail.html', {'nko': nko})


def news_list(request):
    """–°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π"""
    news_list = [
        {
            'id': 1,
            'icon': 'üå≥',
            'date': '10 –Ω–æ—è–±—Ä—è 2025',
            'city': '–°–∞—Ä–æ–≤',
            'title': '–í–æ–ª–æ–Ω—Ç—ë—Ä—ã –≤—ã—Å–∞–¥–∏–ª–∏ 500 –¥–µ—Ä–µ–≤—å–µ–≤ –≤ –≥–æ—Ä–æ–¥—Å–∫–æ–º –ø–∞—Ä–∫–µ',
            'excerpt': '–í —Ä–∞–º–∫–∞—Ö —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∞–∫—Ü–∏–∏ "–ó–µ–ª—ë–Ω—ã–π –≥–æ—Ä–æ–¥" –≤–æ–ª–æ–Ω—Ç—ë—Ä—ã –†–æ—Å–∞—Ç–æ–º–∞ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –º–µ—Å—Ç–Ω—ã–º–∏ –ù–ö–û –≤—ã—Å–∞–¥–∏–ª–∏ –±–æ–ª–µ–µ 500 —Å–∞–∂–µ–Ω—Ü–µ–≤ –¥–µ—Ä–µ–≤—å–µ–≤ –≤ –≥–æ—Ä–æ–¥—Å–∫–æ–º –ø–∞—Ä–∫–µ.'
        },
        {
            'id': 2,
            'icon': 'üé≠',
            'date': '8 –Ω–æ—è–±—Ä—è 2025',
            'city': '–û–±–Ω–∏–Ω—Å–∫',
            'title': '–û—Ç–∫—Ä—ã—Ç –Ω–æ–≤—ã–π –∫—É–ª—å—Ç—É—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¥–ª—è –º–æ–ª–æ–¥—ë–∂–∏',
            'excerpt': '–ü—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –ì–ö –†–æ—Å–∞—Ç–æ–º –≤ –û–±–Ω–∏–Ω—Å–∫–µ –æ—Ç–∫—Ä—ã–ª—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—É–ª—å—Ç—É—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä, –≥–¥–µ –º–æ–ª–æ–¥—ë–∂—å —Å–º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º.'
        }
    ]
    return render(request, 'news.html', {'news_list': news_list})


def news_detail(request, news_id):
    """–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–æ–≤–æ—Å—Ç–∏"""
    return render(request, 'news_detail.html', {'news_id': news_id})


def calendar_view(request):
    """–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π"""
    events_list = [
        {
            'date': '15 –Ω–æ—è–±—Ä—è 2025',
            'title': '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—É–±–±–æ—Ç–Ω–∏–∫ "–ß–∏—Å—Ç—ã–π –≥–æ—Ä–æ–¥"',
            'organizer': '–ù–ö–û "–ó–µ–ª—ë–Ω—ã–π –≥–æ—Ä–æ–¥"',
            'description': '–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤—Å–µ—Ö –∂–µ–ª–∞—é—â–∏—Ö –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ —É–±–æ—Ä–∫–µ –≥–æ—Ä–æ–¥—Å–∫–æ–≥–æ –ø–∞—Ä–∫–∞.',
            'location': '–ì–æ—Ä–æ–¥—Å–∫–æ–π –ø–∞—Ä–∫, –≥. –°–∞—Ä–æ–≤'
        },
        {
            'date': '18 –Ω–æ—è–±—Ä—è 2025',
            'title': '–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ü–µ—Ä—Ç –¥–ª—è –ø–æ–∂–∏–ª—ã—Ö –ª—é–¥–µ–π',
            'organizer': '–ù–ö–û "–î–æ–±—Ä—ã–µ —Å–µ—Ä–¥—Ü–∞"',
            'description': '–ö–æ–Ω—Ü–µ—Ä—Ç–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å —É—á–∞—Å—Ç–∏–µ–º –º–µ—Å—Ç–Ω—ã—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤.',
            'location': '–î–æ–º –∫—É–ª—å—Ç—É—Ä—ã, –≥. –û–±–Ω–∏–Ω—Å–∫'
        }
    ]
    return render(request, 'calendar.html', {'events_list': events_list})


def knowledge_list(request):
    """–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"""
    knowledge_list = [
        {
            'icon': 'üé•',
            'type': '–í–∏–¥–µ–æ',
            'title': '–ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å–∫–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ',
            'description': '–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å–∫–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –æ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏.',
            'view_url': '#',
            'download_url': None
        },
        {
            'icon': 'üìÑ',
            'type': '–î–æ–∫—É–º–µ–Ω—Ç',
            'title': '–®–∞–±–ª–æ–Ω –æ—Ç—á—ë—Ç–∞ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏',
            'description': '–ì–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞ –æ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω–æ–º –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å–∫–æ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏.',
            'view_url': '#',
            'download_url': '#'
        }
    ]
    return render(request, 'knowledge.html', {'knowledge_list': knowledge_list})


"""–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
def register(request):
    from src_new.webModules.registration_page import reg_page
    form = UserRegistrationForm()
    if request.method == 'POST':
        data = request.POST
        email = data.get('email').strip()

        if UsersDB_module().check_presence_mail(mail=email):
            return render(request, 'register.html', {'form': form})

        return reg_page(request=data)
    else:
        form = UserRegistrationForm()
    return render(request, 'register.html', {'form': form})


def login_view(request):
    """–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if request.method == 'POST':
        form = AuthenticationForm(request, data=request.POST)
        if form.is_valid():
            username = form.cleaned_data.get('username')
            password = form.cleaned_data.get('password')
            user = authenticate(username=username, password=password)
            if user is not None:
                login(request, user)
                messages.success(request, f'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {username}!')
                return redirect('index')
    else:
        form = AuthenticationForm()
    return render(request, 'login.html', {'form': form})


def logout_view(request):
    """–í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    logout(request)
    messages.info(request, '–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.')
    return redirect('index')
